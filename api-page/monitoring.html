<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>API Monitoring Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --success: #06d6a0;
      --danger: #ef476f;
      --warning: #ffd166;
      --light: #f8f9fa;
      --dark: #212529;
      --bg-gradient: linear-gradient(135deg, #4361ee, #3a0ca3);
      --card-shadow: 0 10px 20px rgba(0,0,0,0.05), 0 6px 6px rgba(0,0,0,0.07);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f5f7fa;
      color: var(--dark);
      line-height: 1.6;
      padding: 0;
      margin: 0;
    }

    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .dashboard-header {
      background: var(--bg-gradient);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      color: white;
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .dashboard-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .dashboard-subtitle {
      font-size: 1rem;
      font-weight: 400;
      opacity: 0.8;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 20px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      height: 100%;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.1), 0 8px 8px rgba(0,0,0,0.07);
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-icon {
      background: var(--light);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
    }

    /* Grid column spans for different card sizes */
    .server-status {
      grid-column: span 12;
    }

    @media (min-width: 768px) {
      .server-status {
        grid-column: span 4;
      }
      .route-list {
        grid-column: span 8;
      }
      .chart-box {
        grid-column: span 12;
      }
    }

    @media (min-width: 992px) {
      .server-status {
        grid-column: span 3;
      }
      .route-list {
        grid-column: span 9;
      }
      .chart-box {
        grid-column: span 12;
      }
    }

    /* Status indicators */
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
    }

    .status-label {
      font-size: 0.875rem;
      color: #6c757d;
      flex: 1;
    }

    .status-value {
      font-weight: 600;
      font-size: 1rem;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 5px 10px;
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-online {
      background-color: rgba(6, 214, 160, 0.1);
      color: var(--success);
    }

    .badge-offline {
      background-color: rgba(239, 71, 111, 0.1);
      color: var(--danger);
    }

    /* Route list styling */
    .routes-container {
      max-height: 300px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) var(--light);
    }

    .routes-container::-webkit-scrollbar {
      width: 6px;
    }

    .routes-container::-webkit-scrollbar-track {
      background: var(--light);
      border-radius: 10px;
    }

    .routes-container::-webkit-scrollbar-thumb {
      background-color: var(--primary);
      border-radius: 10px;
    }

    .route-list {
      list-style-type: none;
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 10px;
    }

    @media (min-width: 768px) {
      .route-list {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 992px) {
      .route-list {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .route-item {
      padding: 12px 16px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.875rem;
      transition: var(--transition);
      border-left: 3px solid transparent;
    }

    .route-active {
      background-color: rgba(6, 214, 160, 0.1);
      border-left-color: var(--success);
    }

    .route-inactive {
      background-color: rgba(239, 71, 111, 0.1);
      border-left-color: var(--danger);
    }

    .route-path {
      font-weight: 500;
    }

    .route-status {
      padding: 3px 8px;
      border-radius: 100px;
      font-size: 0.7rem;
      font-weight: 700;
    }

    .status-active {
      background-color: var(--success);
      color: white;
    }

    .status-inactive {
      background-color: var(--danger);
      color: white;
    }

    /* Chart styling */
    .chart-container {
      height: 300px;
      position: relative;
    }

    /* Animations */
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(67, 97, 238, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(67, 97, 238, 0);
      }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Loading styles */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 5px;
      height: 20px;
      margin: 5px 0;
    }

    @keyframes loading {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }

    .skeleton-text {
      width: 100%;
    }

    .skeleton-small {
      width: 60%;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="dashboard-header">
      <h1 class="dashboard-title">API Monitoring Dashboard</h1>
      <p class="dashboard-subtitle">Real-time monitoring of API endpoints and server status</p>
    </div>
    
    <div class="dashboard-grid">
      <!-- Server Status Card -->
      <div class="card server-status">
        <h2 class="card-title">
          <div class="card-icon">
            <i class="fas fa-server"></i>
          </div>
          Server Status
        </h2>

        <div class="status-indicator">
          <span class="status-label">Status:</span>
          <span class="status-value">
            <span id="server-status" class="status-badge badge-offline">Loading...</span>
          </span>
        </div>

        <div class="status-indicator">
          <span class="status-label">Time:</span>
          <span id="server-time" class="status-value">Loading...</span>
        </div>

        <div class="status-indicator">
          <span class="status-label">Uptime:</span>
          <span id="server-uptime" class="status-value">Loading...</span>
        </div>

        <div class="status-indicator">
          <span class="status-label">API Routes:</span>
          <span id="total-api-routes" class="status-value">Loading...</span>
        </div>
      </div>

      <!-- API Routes Card -->
      <div class="card route-list">
        <h2 class="card-title">
          <div class="card-icon">
            <i class="fas fa-code-branch"></i>
          </div>
          API Routes
        </h2>
        <div class="routes-container">
          <ul id="route-list" class="route-list">
            <li class="route-item">
              <div class="skeleton skeleton-text"></div>
            </li>
            <li class="route-item">
              <div class="skeleton skeleton-text"></div>
            </li>
            <li class="route-item">
              <div class="skeleton skeleton-text"></div>
            </li>
          </ul>
        </div>
      </div>

      <!-- Chart Card -->
      <div class="card chart-box">
        <h2 class="card-title">
          <div class="card-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          Active Routes (Real-time)
        </h2>
        <div class="chart-container">
          <canvas id="statusChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Update status badge dynamically
    function updateStatusBadge(status) {
      const serverStatus = document.getElementById('server-status');
      serverStatus.textContent = status;
      
      if (status === 'Online') {
        serverStatus.className = 'status-badge badge-online pulse';
      } else {
        serverStatus.className = 'status-badge badge-offline';
      }
    }
    
    // Initialize Chart
    const ctx = document.getElementById('statusChart').getContext('2d');
    const chartData = {
      labels: [],
      datasets: [{
        label: 'Active Routes',
        data: [],
        backgroundColor: 'rgba(67, 97, 238, 0.2)',
        borderColor: 'rgba(67, 97, 238, 1)',
        borderWidth: 2,
        fill: true,
        tension: 0.4,
        pointRadius: 4,
        pointBackgroundColor: 'white',
        pointBorderColor: 'rgba(67, 97, 238, 1)',
        pointBorderWidth: 2
      }]
    };

    const statusChart = new Chart(ctx, {
      type: 'line',
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              boxWidth: 15,
              usePointStyle: true,
              pointStyle: 'circle'
            }
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(255, 255, 255, 0.9)',
            titleColor: '#212529',
            bodyColor: '#212529',
            borderColor: 'rgba(67, 97, 238, 0.3)',
            borderWidth: 1,
            cornerRadius: 8,
            padding: 10,
            boxPadding: 5
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            },
            ticks: {
              color: '#6c757d'
            },
            title: { 
              display: true, 
              text: 'Time',
              color: '#6c757d',
              font: {
                size: 12,
                weight: 'normal'
              }
            }
          },
          y: {
            beginAtZero: true,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            },
            ticks: {
              precision: 0,
              color: '#6c757d'
            },
            title: { 
              display: true, 
              text: 'Active Routes',
              color: '#6c757d',
              font: {
                size: 12,
                weight: 'normal'
              }
            }
          }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        },
        animations: {
          tension: {
            duration: 1000,
            easing: 'linear'
          }
        }
      }
    });

    function updateDashboard() {
      fetch('/monitoring')
        .then(res => res.json())
        .then(data => {
          // Update the server status
          updateStatusBadge(data.serverStatus);
          document.getElementById('server-time').textContent = data.time;
          document.getElementById('server-uptime').textContent = data.uptime;
          document.getElementById('total-api-routes').textContent = data.apiRoutes.length;

          // Update the routes list
          const routeList = document.getElementById('route-list');
          routeList.innerHTML = '';

          let activeCount = 0;

          data.apiRoutes.forEach(route => {
            const li = document.createElement('li');
            li.className = route.status === 'Active' ? 'route-item route-active' : 'route-item route-inactive';
            
            const routePath = document.createElement('span');
            routePath.className = 'route-path';
            routePath.textContent = route.path;
            
            const routeStatus = document.createElement('span');
            routeStatus.className = route.status === 'Active' ? 'route-status status-active' : 'route-status status-inactive';
            routeStatus.textContent = route.status;
            
            li.appendChild(routePath);
            li.appendChild(routeStatus);
            routeList.appendChild(li);
            
            if (route.status === 'Active') activeCount++;
          });

          // Chart update with smooth animation
          const now = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', second: '2-digit'});
          
          if (chartData.labels.length >= 10) {
            chartData.labels.shift();
            chartData.datasets[0].data.shift();
          }
          
          chartData.labels.push(now);
          chartData.datasets[0].data.push(activeCount);
          statusChart.update('normal');
        })
        .catch(err => {
          updateStatusBadge('Offline');
          document.getElementById('server-time').textContent = 'N/A';
          document.getElementById('server-uptime').textContent = 'N/A';
          document.getElementById('total-api-routes').textContent = 'N/A';
          
          const routeList = document.getElementById('route-list');
          routeList.innerHTML = '';
          
          const errorLi = document.createElement('li');
          errorLi.className = 'route-item route-inactive';
          errorLi.textContent = 'Gagal mengambil data';
          routeList.appendChild(errorLi);
        });
    }

    // Run first time
    updateDashboard();
    
    // Update every 5 seconds
    setInterval(updateDashboard, 5000);
  </script>
</body>
</html>
